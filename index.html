<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#10B981">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-title" content="CRRT Dose Calculator">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="CRRT Dose Calculator">
    
    <title>CRRT Dose Calculator</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="./css/crrt_calculator.css">
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col-auto">
                    <button id="menuBtn" class="btn btn-link text-dark">
                        <span class="material-icons">menu</span>
                    </button>
                </div>
                <div class="col text-center">
                    <h1 class="app-title mb-0">CRRT 용량 계산기</h1>
                    <p class="app-subtitle mb-0">Continuous Renal Replacement Therapy</p>
                </div>
                <div class="col-auto">
                    <!-- 가이드 버튼 제거됨 - 사이드바 메뉴에서 접근 가능 -->
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar Menu -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h5>CRRT 계산기</h5>
            <button id="closeSidebar" class="btn-close"></button>
        </div>
        <div class="sidebar-content">
            <div class="list-group list-group-flush">
                <button class="list-group-item list-group-item-action" id="guideMenuItem">
                    <span class="material-icons">info</span>
                    초기 설정 가이드
                </button>

                <hr>
                <button class="list-group-item list-group-item-action" id="loadDataMenuItem">
                    <span class="material-icons">restore</span>
                    저장된 데이터 로드
                </button>
                <button class="list-group-item list-group-item-action" id="settingsMenuItem">
                    <span class="material-icons">settings</span>
                    설정
                </button>
                <hr>
                <button class="list-group-item list-group-item-action text-danger" id="clearDataMenuItem">
                    <span class="material-icons">delete</span>
                    모든 데이터 초기화
                </button>
            </div>
        </div>
    </div>
    <div id="sidebarOverlay" class="sidebar-overlay"></div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container-fluid">
            <!-- Input Section -->
            <div class="row">
                <div class="col-12">
                    <div class="card input-card">
                        <div class="card-header">
                            <h5 class="mb-0">입력 데이터 (Input Data)</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- Patient Data -->
                                <div class="col-md-6">
                                    <h6 class="section-title">환자 데이터 (Patient Data)</h6>
                                    <div class="mb-3">
                                        <label for="weight" class="form-label">체중 (Weight) <span class="text-muted">(kg)</span></label>
                                        <input type="number" class="form-control" id="weight" placeholder="체중을 입력하세요" step="0.1" min="0">
                                    </div>
                                    <div class="mb-3">
                                        <label for="hematocrit" class="form-label">헤마토크릿 (Hematocrit) <span class="text-muted">(%)</span></label>
                                        <input type="number" class="form-control" id="hematocrit" placeholder="헤마토크릿을 입력하세요" step="0.1" min="0" max="100">
                                    </div>
                                </div>
                                
                                <!-- Prescription Data -->
                                <div class="col-md-6">
                                    <h6 class="section-title">처방 데이터 (Prescription Data)</h6>
                                    <div class="mb-3">
                                        <label for="bloodFlowRate" class="form-label">혈류량 (Blood Flow Rate) <span class="text-muted">(mL/min)</span></label>
                                        <input type="number" class="form-control" id="bloodFlowRate" placeholder="혈류량을 입력하세요" step="1" min="0">
                                    </div>
                                    <div class="mb-3">
                                        <label for="preDilution" class="form-label">전희석 (Pre-dilution) <span class="text-muted">(mL/hr)</span></label>
                                        <input type="number" class="form-control" id="preDilution" placeholder="전희석을 입력하세요" step="1" min="0">
                                    </div>
                                    <div class="mb-3">
                                        <label for="postDilution" class="form-label">후희석 (Post-dilution) <span class="text-muted">(mL/hr)</span></label>
                                        <input type="number" class="form-control" id="postDilution" placeholder="후희석을 입력하세요" step="1" min="0">
                                    </div>
                                    <div class="mb-3">
                                        <label for="dialysate" class="form-label">투석액 (Dialysate) <span class="text-muted">(mL/hr)</span></label>
                                        <input type="number" class="form-control" id="dialysate" placeholder="투석액을 입력하세요" step="1" min="0">
                                    </div>
                                    <div class="mb-3">
                                        <label for="ultraFiltration" class="form-label">초과여과 (Ultra-filtration) <span class="text-muted">(mL/hr)</span></label>
                                        <input type="number" class="form-control" id="ultraFiltration" placeholder="초과여과를 입력하세요" step="1" min="0">
                                    </div>
                                    <div class="mb-3">
                                        <label for="prescribedTime" class="form-label">처방시간 (Prescribed Time) <span class="text-muted">(hr)</span></label>
                                        <input type="number" class="form-control" id="prescribedTime" placeholder="처방시간을 입력하세요" step="0.5" min="0">
                                    </div>
                                    <div class="mb-3">
                                        <label for="actualRuntime" class="form-label">실제운행시간 (Actual Runtime) <span class="text-muted">(hr)</span></label>
                                        <input type="number" class="form-control" id="actualRuntime" placeholder="실제운행시간을 입력하세요" step="0.5" min="0">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <div class="row mt-3">
                                <div class="col-12 text-center">
                                    <button id="calculateBtn" class="btn btn-primary btn-lg me-2">
                                        <span class="material-icons">calculate</span>
                                        계산하기 (Calculate)
                                    </button>
                                    <button id="clearBtn" class="btn btn-outline-secondary btn-lg me-2">
                                        <span class="material-icons">clear</span>
                                        초기화 (Clear)
                                    </button>
                                    <button id="saveBtn" class="btn btn-success btn-lg">
                                        <span class="material-icons">save</span>
                                        저장 (Save)
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div class="row mt-4" id="resultsSection" style="display: none;">
                <div class="col-12">
                    <div class="card results-card">
                        <div class="card-header">
                            <h5 class="mb-0">계산 결과 (Calculation Results)</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="result-item">
                                        <h6>혈장 유량 (Plasma Flow)</h6>
                                        <div class="result-value" id="plasmaFlowResult">-</div>
                                        <small class="text-muted">mL/hr</small>
                                    </div>
                                    <div class="result-item">
                                        <h6>처방 용량 (Prescribed Dose)</h6>
                                        <div class="result-value" id="effluentDoseResult">-</div>
                                        <small class="text-muted">mL/kg/hr</small>
                                    </div>
                                    <div class="result-item">
                                        <h6>여과분율 (Filtration Fraction)</h6>
                                        <div class="result-value" id="filtrationFractionResult">-</div>
                                        <small class="text-muted">%</small>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="result-item">
                                        <h6>희석인자 (Dilution Factor)</h6>
                                        <div class="result-value" id="dilutionFactorResult">-</div>
                                        <small class="text-muted">-</small>
                                    </div>
                                    <div class="result-item">
                                        <h6>실제 전달 용량 (Actual Delivered Dose)</h6>
                                        <div class="result-value" id="actualDeliveredDoseResult">-</div>
                                        <small class="text-muted">mL/kg/hr</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Calculation Steps Section -->
            <div class="row mt-4" id="calculationStepsSection" style="display: none;">
                <div class="col-12">
                    <div class="card steps-card">
                        <div class="card-header">
                            <h5 class="mb-0">계산 과정 (Calculation Steps)</h5>
                        </div>
                        <div class="card-body">
                            <div id="calculationStepsContent">
                                <!-- Calculation steps will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Warnings Section -->
            <div class="row mt-4" id="warningsSection" style="display: none;">
                <div class="col-12">
                    <div class="card warnings-card">
                        <div class="card-header">
                            <h5 class="mb-0">경고 및 알림 (Warnings & Alerts)</h5>
                        </div>
                        <div class="card-body">
                            <!-- Warnings will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dilution Factor Interpretation Section -->
            <div class="row mt-4" id="dilutionFactorInterpretationSection" style="display: none;">
                <div class="col-12">
                    <div class="card interpretation-card">
                        <div class="card-header">
                            <h5 class="mb-0">희석인자 해석 (Dilution Factor Interpretation)</h5>
                        </div>
                        <div class="card-body">
                            <!-- Dilution factor interpretation will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recommended Ranges Section -->
            <div class="row mt-4" id="recommendedRangesSection" style="display: none;">
                <div class="col-12">
                    <div class="card ranges-card">
                        <div class="card-header">
                            <h5 class="mb-0">권장 범위 (Recommended Ranges)</h5>
                        </div>
                        <div class="card-body">
                            <!-- Recommended ranges will be populated here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Guide Modal -->
    <div class="modal fade" id="guideModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">초기 설정 가이드 (Initial Setup Guide)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <h6>💡 선택 안내 (Selection Guide)</h6>
                        <ul class="mb-0">
                            <li>선택한 값이 계산기에 자동 적용됩니다</li>
                            <li>체중은 범위의 중간값이 선택됩니다</li>
                            <li>Hct 30%, UF 50, 시간 24/20hr 자동 설정</li>
                        </ul>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-bordered table-hover" id="guideTable">
                            <thead class="table-primary">
                                <tr>
                                    <th>체중(kg) (Weight)</th>
                                    <th>혈류량 (Blood flow, mL/min)</th>
                                    <th>전희석 (Pre, mL/h)</th>
                                    <th>후희석 (Post, mL/h)</th>
                                    <th>투석액 (Dialysate rate, mL/h)</th>
                                    <th>선택 (Select)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Guide table rows will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">설정 (Settings)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="form-check form-switch">
                        <input class="form-check-input" type="checkbox" id="autoSaveSwitch" checked>
                        <label class="form-check-label" for="autoSaveSwitch">
                            자동 저장 (Auto Save)
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Load Data Modal -->
    <div class="modal fade" id="loadDataModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">저장된 데이터 로드 (Load Saved Data)</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="savedDataContent">
                        <!-- Saved data will be displayed here -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="loadDataBtn">데이터 로드 (Load Data)</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">닫기 (Close)</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="./js/crrt_calculator.js"></script>
</body>
</html>
